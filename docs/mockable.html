<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<link href="css/theme.css" type="text/css" rel="stylesheet" media="all" />
		<title>dunit.mockable</title>
	</head>
	<body>
		<h1>dunit.mockable</h1>
		<!-- Generated by Ddoc from dunit/mockable.d -->
<div class="sections"><p>Mixin template to enable mocking.
</p>
<p>Many methods implement compile-time parameters (file, line) that are set at the call site.
 It is preferred that these parameters are ignored when using these methods.

</p>
<h3>License</h3><p>MIT. See LICENSE for full details.</p>
</div>
<div class="module-members"><h2><a name="Mockable"></a>template <span class="symbol">Mockable</span>(C) if (is(C == class))</h2>
<div class="declaration-description"><div class="sections"><p>A template mixin used to inject code into a class to provide mockable behaviour.
 Code is nested within the host class to provide access to all host types.
 <b>Only injects code when using the -unittest compiler switch.</b>
</p>
<p><h3>Caveats:</h3>
Only module level types can be made mockable.

</p>
<p><h3>Example:</h3>
<pre><span class="keyword">import</span> dunit.mockable;

<span class="keyword">class</span> T
{
    <span class="keyword">mixin</span> <span class="symbol">Mockable</span>!(T);
}
</pre>
</p>
</div>
<div class="template-members"><h2><a name="getMock"></a>auto <span class="symbol">getMock</span>(A...)(A <em>args</em>);
</h2>
<div class="declaration-description"><div class="sections"><p>Injected by the Mockable mixin template this method allows creation of mock object instances of the mockable class.
</p>
<h3>Parameters</h3><table class="parameter-list"><tr><td>args</td>
<td>The constructor arguments of the host class.</td></tr>
</table>
<p><h3>Example:</h3>
<pre><span class="keyword">import</span> dunit.mockable;

<span class="keyword">class</span> T
{
    <span class="keyword">mixin</span> Mockable!(T);
}

<span class="keyword">unittest</span>
{
    <span class="keyword">import</span> dunit.toolkit;

    <span class="keyword">auto</span> mock = T.<span class="symbol">getMock</span>();

    assertTrue(<span class="keyword">cast</span>(T)mock); <span class="comment">// Mock extends T.
</span>}
</pre>

</p>
<p><h3>Templates:</h3>
 Templated classes are supported when creating mocks.
 Simply include the template parameters for the class when calling the '<span class="symbol">getMock</span>' method.
<pre><span class="keyword">auto</span> mock = T!(<span class="keyword">int</span>).<span class="symbol">getMock</span>(); <span class="comment">// Get a mock of T!(int).
</span></pre>
</p>
</div>
</div>
<h2><a name="Mock"></a>class <span class="symbol">Mock</span>(C) if (is(C == class)): C;
</h2>
<div class="declaration-description"><div class="sections"><p>Injected by the Mockable mixin template this class contains all mocking behaviour.
</p>
<p>This <span class="symbol">Mock</span> class extends any class it's injected into and provides methods to interact with the mocked instance.
 An instance of this class can dynamically replace any of its methods at runtime using the 'mockMethod' method.
 All mocked methods can optionally have their call counts asserted to be within set limits.</p>
</div>
<div class="class-members"><h2><a name="mockMethod"></a>void <span class="symbol">mockMethod</span>(T)(string <em>name</em>, T <em>delegate_</em>, ulong <em>minimumCount</em> = 0, ulong <em>maximumCount</em> = (ulong).max, string <em>file</em> = __FILE__, ulong <em>line</em> = __LINE__);
</h2>
<div class="declaration-description"><div class="sections"><p>Replace a method in the mock object by adding a mock method to be called in its place.
 <b>By default parent methods are called in lieu of any replacements unless parent methods are disabled.</b>
</p>
<h3>Parameters</h3><table class="parameter-list"><tr><td>name</td>
<td>The name of the method to replace. (Only the name should be used, no parameters, etc.)</td></tr>
<tr><td>delegate_</td>
<td>The delegate to be used instead of calling the original method.
              The delegate must have the exact signature of the method being replaced.</td></tr>
<tr><td>minimumCount</td>
<td>The minimum amount of times this method must be called when asserting calls.</td></tr>
<tr><td>maximumCount</td>
<td>The maximum amount of times this method must be called when asserting calls.</td></tr>
<tr><td>file</td>
<td>The file name where the error occurred. The value is added automatically at the call site.</td></tr>
<tr><td>line</td>
<td>The line where the error occurred. The value is added automatically at the call site.</td></tr>
</table>
<h3>Exceptions Thrown</h3><p>DUnitAssertError if the passed delegate does not match the signature of any overload of the method named.

</p>
<p><h3>Caveats:</h3>
<ol>        <li>In the case of replacing overloaded methods the delegate signature defines which method to replace. Helpful errors will be raised on non matching signatures.</li>
         <li>Templated methods are final by default and therefore cannot be mocked.</li>
     </ol>

</p>
<h3>See Also</h3><p>disableParentMethods()

</p>
<p><h3>Example:</h3>
<pre><span class="keyword">import</span> dunit.mockable;

<span class="keyword">class</span> T
{
    <span class="keyword">int</span> getValue()
    {
        <span class="keyword">return</span> 1;
    }

    <span class="keyword">mixin</span> Mockable!(T);
}

<span class="keyword">unittest</span>
{
    <span class="keyword">import</span> dunit.toolkit;

    <span class="keyword">auto</span> mock = T.getMock();

    <span class="comment">// Replace the 'getValue' method.
</span>    mock.<span class="symbol">mockMethod</span>(<span class="string">"getValue"</span>, <span class="keyword">delegate</span>(){
        <span class="keyword">return</span> 2;
    });

    mock.getValue().assertEqual(2);
}
</pre>
</p>
</div>
</div>
<h2><a name="disableParentMethods"></a>void <span class="symbol">disableParentMethods</span>(string <em>file</em> = __FILE__, ulong <em>line</em> = __LINE__);
</h2>
<div class="declaration-description"><div class="sections"><p>Disable parent methods being called if mock replacements are not implemented.
 If parent methods have been disabled a helpful assert error will be raised on any attempt to call methods that haven't been replaced.
 This is helpful if necessary to disable all behaviour of the mocked class.
</p>
<h3>Parameters</h3><table class="parameter-list"><tr><td>string <em>file</em></td>
<td>The <em>file</em> name where the error occurred. The value is added automatically at the call site.</td></tr>
<tr><td>ulong <em>line</em></td>
<td>The <em>line</em> where the error occurred. The value is added automatically at the call site.</td></tr>
</table>
<h3>See Also</h3><p>mockMethod()

</p>
<p><h3>Example:</h3>
<pre><span class="keyword">import</span> dunit.mockable;

<span class="keyword">class</span> T
{
    <span class="keyword">mixin</span> Mockable!(T);
}

<span class="keyword">unittest</span>
{
    <span class="keyword">auto</span> mock = T.getMock();
    mock.<span class="symbol">disableParentMethods</span>();

    <span class="comment">// All mock object methods that are used in the test
</span>    <span class="comment">// must now be replaced to avoid an error being thrown.
</span>}
</pre>
</p>
</div>
</div>
<h2><a name="assertMethodCalls"></a>void <span class="symbol">assertMethodCalls</span>(string <em>message</em> = "Failed asserting call count", string <em>file</em> = __FILE__, ulong <em>line</em> = __LINE__);
</h2>
<div class="declaration-description"><div class="sections"><p>Assert all replaced methods are called the defined amount of times.
</p>
<h3>Parameters</h3><table class="parameter-list"><tr><td>string <em>message</em></td>
<td>The error <em>message</em> to display.</td></tr>
<tr><td>string <em>file</em></td>
<td>The <em>file</em> name where the error occurred. The value is added automatically at the call site.</td></tr>
<tr><td>ulong <em>line</em></td>
<td>The <em>line</em> where the error occurred. The value is added automatically at the call site.</td></tr>
</table>
<h3>Exceptions Thrown</h3><p>DUnitAssertError if any method was called outside of preset boundries.

</p>
<p><h3>Example:</h3>
<pre><span class="keyword">import</span> dunit.mockable;

<span class="keyword">class</span> T
{
    <span class="keyword">int</span> getValue()
    {
        <span class="keyword">return</span> 1;
    }

    <span class="keyword">mixin</span> Mockable!(T);
}

<span class="keyword">unittest</span>
{
    <span class="keyword">import</span> dunit.toolkit;

    <span class="keyword">auto</span> mock = T.getMock();

    <span class="comment">// Replace method while defining a minimum call limit.
</span>    mock.mockMethod(<span class="string">"getValue"</span>, <span class="keyword">delegate</span>(){
        <span class="keyword">return</span> 2;
    }, 1);

    <span class="comment">// Increase the call count of 'getValue' by one.
</span>    mock.getValue().assertEqual(2);

    <span class="comment">// Assert methods calls are within defined limits.
</span>    mock.<span class="symbol">assertMethodCalls</span>();
}
</pre>
</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

	</body>
</html>
